## 策略概述
这是一个基于**“缠论”**（一种非常有名的中国本土量化理论）的交易策略。简单来说，它的作用是**把杂乱无章的股票K线图，画成简单的折线图，找出股价真正的转折点**。

## 策略的核心思路
股票价格的波动就像海浪一样，有大浪也有小浪，还有很多杂乱的水花。
这个策略的核心想法是：**忽略小水花，看清大浪潮。**

它认为股价的走势是有结构的：
1.  **去噪**：先把那些没有意义的小波动过滤掉。
2.  **找结构**：看出股价是在上涨、下跌，还是在横盘（震荡）。
3.  **抓转折**：当下跌的力量耗尽时买入，当上涨的力量耗尽时卖出。

## 具体操作步骤

虽然代码很长，但它其实就在做一件事：**像搭积木一样，一层一层地处理数据**。

### 第一步：整理K线（去噪）
**做什么**：
你看到的K线图（蜡烛图）里，有些K线被包含在前面的K线里（比如今天的最高价没昨天高，最低价也没昨天低）。
这个策略认为这种K线是“废话”，没有方向意义。
**怎么做**：
策略会自动把这些“被包含”的K线和前一根K线**合并成一根新的K线**。
**为什么**：
为了让图表更干净，不被细小的波动干扰判断。

### 第二步：找“顶”和“底”（分型）
**做什么**：
在整理好的K线中，找出局部的最高点和最低点。
**怎么做**：
-   **顶分型**：像一个倒写的“V”字（中间高，两边低），这就是暂时的**顶**。
-   **底分型**：像一个正写的“V”字（中间低，两边高），这就是暂时的**底**。

### 第三步：画“笔”（连线）
**做什么**：
把找到的“顶”和“底”连起来，画成一条条直线。
**怎么做**：
代码中叫 `on_stroke`。它把一个底分型和一个顶分型连起来，这就构成了一“笔”。
**为什么**：
这一步把复杂的K线图变成了简单的**折线图**，让你一眼就能看出股价是往上走还是往下走。

### 第四步：找“中枢”（战场）
**做什么**：
这是缠论最核心的概念。策略会寻找股价**反复纠缠、上下震荡**的区域。
**怎么做**：
代码中叫 `on_pivot`。如果股价连续三笔（上-下-上，或 下-上-下）都有重叠的区域，这个重叠区就是“中枢”。
**为什么**：
“中枢”就像是多方（买家）和空方（卖家）激烈争夺的**战场**。
-   如果股价跌破战场，但跌不下去了（力量减弱），可能就是买点。
-   如果股价涨破战场，但涨不动了，可能就是卖点。

### 第五步：买卖判断（基于MACD和结构）
*注意：提供的代码主要集中在构建上述结构，具体的买卖触发点虽然在代码逻辑中隐含，但可以推断如下：*

**买入时机**：
当股价跌出“中枢”后，虽然价格创新低，但**MACD指标**（一种看力度的工具）显示下跌的力量变弱了（这叫“背驰”）。这时候策略会判断“空头累了”，准备买入。

**卖出时机**：
反之，当股价涨出“中枢”后，虽然价格创新高，但MACD显示上涨力量变弱了。策略判断“多头累了”，准备卖出。

## 使用的工具/指标

1.  **MACD（异同移动平均线）**：
    -   **是什么**：你可以把它想象成汽车的**速度表**。
    -   **为什么用它**：策略用它来判断股价上涨或下跌的**力度**。如果股价在跌，但MACD显示速度在变慢（刹车了），那就是反转的信号。

2.  **SMA/EMA（均线）**：
    -   **是什么**：过去一段时间的平均价格。
    -   **为什么用它**：辅助判断大趋势的方向。

## 风险控制

代码中定义了简单的仓位管理（头寸控制）：
-   `self.buy1 = 100`, `self.buy2 = 200`...
-   这意味着策略**不会一次性全仓买入**。它可能会分批买入（比如先买100股，确认涨了再买200股），这样如果判断错了，亏损会比较小。

## 总结

这个策略就像一个**精密的绘图师**。它不看单根K线的涨跌，而是通过**合并K线 -> 找顶底 -> 画折线 -> 找震荡区**这一套流程，把复杂的股市行情简化成清晰的几何图形。

它的核心逻辑是：**在股价跌不动的时候买入，在涨不动的时候卖出**，而判断“动不动”的标准，就是看它构建的几何结构和MACD力度。